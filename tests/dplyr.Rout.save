
R version 3.3.2 (2016-10-31) -- "Sincere Pumpkin Patch"
Copyright (C) 2016 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> library(sf)
Linking to GEOS 3.5.0, GDAL 2.1.0
> library(dplyr)

Attaching package: 'dplyr'

The following objects are masked from 'package:stats':

    filter, lag

The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union

> nc = st_read(system.file("shape/nc.shp", package="sf"), crs = 4267)
Reading layer `nc' from data source `/home/edzer/git/sf.Rcheck/sf/shape/nc.shp' using driver `ESRI Shapefile'
features:       100
fields:         14
converted into: MULTIPOLYGON
proj4string:    +proj=longlat +datum=NAD27 +no_defs 
> nc %>% filter(AREA > .1) %>% plot()
> 
> # plot 10 smallest counties in grey:
> nc %>% plot()
> nc %>% arrange(AREA) %>% slice(1:10) %>% plot(add = TRUE, col = 'grey')
> 
> # select: check both when geometry is part of the selection, and when not:
> nc %>% select(SID74, SID79) %>% names()
[1] "SID74" "SID79"
> nc %>% select(SID74, SID79, geometry) %>% names()
[1] "SID74"    "SID79"    "geometry"
> nc %>% select(SID74, SID79) %>% class()
[1] "data.frame"
> nc %>% select(SID74, SID79, geometry) %>% class()
[1] "sf"         "data.frame"
> 
> library(tidyr)
> 
> # time-wide to long table, using tidyr::gather
> # stack the two SID columns for the July 1, 1974 - June 30, 1978 and July 1, 1979 - June 30, 1984 periods
> # (see https://cran.r-project.org/web/packages/spdep/vignettes/sids.pdf)
> nc %>% select(SID74, SID79, geometry) %>% gather(VAR, SID, -geometry) %>% summary()
     VAR                 SID                  geometry  
 Length:200         Min.   : 0.000   MULTIPOLYGON :200  
 Class :character   1st Qu.: 2.000   epsg:4267    :  0  
 Mode  :character   Median : 5.000   +proj=long...:  0  
                    Mean   : 7.515                      
                    3rd Qu.: 9.000                      
                    Max.   :57.000                      
> 
> # spread:
> nc$row = 1:100
> nc.g <- nc %>% select(SID74, SID79, row) %>% gather(VAR, SID, -row)
> nc.g %>% tail()
    row   VAR SID
195  95 SID79   4
196  96 SID79   5
197  97 SID79   3
198  98 SID79  17
199  99 SID79   9
200 100 SID79   6
> nc.g %>% spread(VAR, SID)
    row SID74 SID79
1     1     1     0
2     2     0     3
3     3     5     6
4     4     1     2
5     5     9     3
6     6     7     5
7     7     0     2
8     8     0     2
9     9     4     2
10   10     1     5
11   11     2     2
12   12    16     5
13   13     4     4
14   14     4     4
15   15     4     6
16   16    18    17
17   17     3     4
18   18     4     7
19   19     1     1
20   20     1     0
21   21     1     1
22   22     0     0
23   23     1     1
24   24     2     0
25   25    10    18
26   26    23    38
27   27    13    11
28   28     6     5
29   29     4     6
30   30    16    22
31   31     8     7
32   32     0     2
33   33    10     9
34   34     6     9
35   35     0     1
36   36     2     1
37   37    16    31
38   38     2     2
39   39     4     5
40   40     1     3
41   41     0     2
42   42     8     8
43   43     5    15
44   44     5     0
45   45     0     0
46   46     5     5
47   47     7    12
48   48     2     3
49   49    11    13
50   50     3     8
51   51    14    11
52   52     5    21
53   53     9    18
54   54     6    13
55   55     2     8
56   56     0     1
57   57     7     4
58   58     3     2
59   59     4     4
60   60     5     6
61   61    12     8
62   62    18    23
63   63     6    10
64   64    10    21
65   65     8     7
66   66     2     5
67   67     5     5
68   68    44    35
69   69     3    20
70   70     3     8
71   71     5     7
72   72     5     8
73   73     0     1
74   74    10    14
75   75     3     4
76   76    11    26
77   77     1     0
78   78     0     3
79   79     4     4
80   80     1     1
81   81     2     1
82   82    38    57
83   83     1     2
84   84     4     9
85   85    15     4
86   86     7     6
87   87     0     0
88   88     4     7
89   89     4     7
90   90     0     0
91   91    13    18
92   92     8    16
93   93    29    23
94   94    31    26
95   95     5     4
96   96     8     5
97   97     4     3
98   98    15    17
99   99    12     9
100 100     5     6
> nc %>% select(SID74, SID79, geometry, row) %>% gather(VAR, SID, -geometry, -row) %>% spread(VAR, SID) %>% head()
Simple feature collection with 6 features and 3 fields
geometry type:  MULTIPOLYGON
dimension:      XY
bbox:           xmin: -81.74107 ymin: 36.07282 xmax: -75.77316 ymax: 36.58965
epsg (SRID):    4267
proj4string:    +proj=longlat +datum=NAD27 +no_defs
  row                       geometry SID74 SID79
1   1 MULTIPOLYGON(((-81.47275543...     1     0
2   2 MULTIPOLYGON(((-81.23989105...     0     3
3   3 MULTIPOLYGON(((-80.45634460...     5     6
4   4 MULTIPOLYGON(((-76.00897216...     1     2
5   5 MULTIPOLYGON(((-77.21766662...     9     3
6   6 MULTIPOLYGON(((-76.74506378...     7     5
> 
> proc.time()
   user  system elapsed 
  0.796   0.308   0.793 
